<div class="evaluation-container">
  <!-- Live Risk Dashboard -->
  <nb-card class="risk-dashboard mb-4">
    <nb-card-header>
      <h4>üîí Live Security Risk Assessment Dashboard</h4>
    </nb-card-header>
    <nb-card-body>
      <div class="row">
        <div class="col-md-6">
          <h5>Overall Risk Score</h5>
          <div class="risk-score-display">
            <span class="risk-score" [style.color]="getRiskColor()">
              {{ cvssScores.overallRiskScore.toFixed(1) }}/10
            </span>
            <span class="risk-rating" [style.color]="getRiskColor()">
              {{ getCVSSSeverityRating() }}
            </span>
          </div>
          <nb-progress-bar 
            [value]="cvssScores.overallRiskScore * 10" 
            [status]="getCVSSSeverityRating() === 'Critical' ? 'danger' : 
                     getCVSSSeverityRating() === 'High' ? 'warning' : 
                     getCVSSSeverityRating() === 'Medium' ? 'info' : 'success'">
          </nb-progress-bar>
        </div>
        
      </div>
    </nb-card-body>
  </nb-card>

  <!-- Project Information Section -->
  <nb-card class="mb-4">
  <nb-card-header>
    <h4>üìã Project Information</h4>
  </nb-card-header>
  <nb-card-body>
    <div class="row">
      <div class="col-md-6">
        <label class="label">1. What is the name of your project? *</label>
        <input nbInput
               fullWidth
               placeholder="Enter project name"
               [(ngModel)]="answers.projectName"
               (ngModelChange)="onAnswerChange('projectName', $event)">
        <div class="risk-indicator" *ngIf="currentQuestionRisk['projectName']">
          <nb-alert [status]="currentQuestionRisk['projectName'].status">
            {{ currentQuestionRisk['projectName'].message }}
          </nb-alert>
        </div>
      </div>

      <div class="col-md-6">
        <label class="label">2. Where is your project hosted? *</label>
        <nb-radio-group [(ngModel)]="answers.repoType"
                        (ngModelChange)="onAnswerChange('repoType', $event)">
          <nb-radio value="public">GitHub Repository</nb-radio>
          <nb-radio value="private">GitLab Repository</nb-radio>
        </nb-radio-group>

        <div *ngIf="answers.repoType === 'public'" class="mt-3">
          <input nbInput
                 fullWidth
                 placeholder="GitHub Repository URL"
                 [(ngModel)]="answers.githubURL">
          <input nbInput
                 fullWidth
                 placeholder="GitHub Token (optional)"
                 [(ngModel)]="answers.githubToken"
                 type="password"
                 class="mt-2">
          <div class="mt-2">
            <button nbButton status="primary" (click)="cloneGithubRepo()" class="me-2">
              Clone Repository
            </button>
            <button nbButton status="info" (click)="analyzeRepository('github')">
              Analyze Repository
            </button>
          </div>
        </div>

        <div *ngIf="answers.repoType === 'private'" class="mt-3">
          <input nbInput
                 fullWidth
                 placeholder="GitLab Repository URL"
                 [(ngModel)]="answers.gitlabURL">
          <input nbInput
                 fullWidth
                 placeholder="GitLab Access Token *"
                 [(ngModel)]="answers.gitlabToken"
                 type="password"
                 class="mt-2">
          <div class="mt-2">
            <button nbButton status="primary" (click)="cloneGitlabRepo()" class="me-2">
              Clone Repository
            </button>
            <button nbButton status="info" (click)="analyzeRepository('gitlab')">
              Analyze Repository
            </button>
          </div>
        </div>

        <div class="risk-indicator" *ngIf="currentQuestionRisk['repoType']">
          <nb-alert [status]="currentQuestionRisk['repoType'].status">
            {{ currentQuestionRisk['repoType'].message }}
            <ng-container *ngIf="currentQuestionRisk['repoType'].consequence">
              <br><strong>Consequence:</strong> {{ currentQuestionRisk['repoType'].consequence }}
            </ng-container>
            <ng-container *ngIf="currentQuestionRisk['repoType'].recommendation">
              <br><strong>Recommendation:</strong> {{ currentQuestionRisk['repoType'].recommendation }}
            </ng-container>
          </nb-alert>
        </div>
      </div>
    </div>

    <div class="row mt-3">
      <div class="col-md-4">
        <label class="label">3. What is the main objective of your project?</label>
        <textarea nbInput
                  fullWidth
                  placeholder="Describe project objective"
                  [(ngModel)]="answers.projectObjective"
                  rows="3">
          </textarea>
      </div>

      <div class="col-md-4">
        <label class="label">4. Who are the stakeholders involved? *</label>
        <textarea nbInput
                  fullWidth
                  placeholder="List key stakeholders"
                  [(ngModel)]="answers.stakeholders"
                  rows="3">
          </textarea>
      </div>

      <div class="col-md-4">
        <label class="label">5. Provide your email address for report delivery *</label>
        <input nbInput
               fullWidth
               type="email"
               placeholder="your.email@company.com"
               [(ngModel)]="answers.email">
      </div>
    </div>
  </nb-card-body>
</nb-card>

<nb-card class="mb-4">
  <nb-card-header>
    <h4>üõ°Ô∏è Exploitability Assessment </h4>
    <p class="text-muted">These questions assess how easily an attacker could exploit vulnerabilities</p>
  </nb-card-header>
  <nb-card-body>
    <div class="row">
      <div class="col-md-6">
        <label class="label">6. Do you use Multi-Factor Authentication (MFA)? *</label>
        <nb-radio-group [(ngModel)]="answers.mfa"
                        (ngModelChange)="onAnswerChange('mfa', $event)">
          <nb-radio value="yes">Yes - MFA is enabled</nb-radio>
          <nb-radio value="no">No - Password only</nb-radio>
        </nb-radio-group>
        <div class="risk-indicator" *ngIf="currentQuestionRisk['mfa']">
          <nb-alert [status]="currentQuestionRisk['mfa'].status">
            {{ currentQuestionRisk['mfa'].message }}
            <ng-container *ngIf="currentQuestionRisk['mfa'].consequence">
              <br><strong>Impact:</strong> {{ currentQuestionRisk['mfa'].consequence }}
            </ng-container>
            <ng-container *ngIf="currentQuestionRisk['mfa'].recommendation">
              <br><strong>Recommendation:</strong> {{ currentQuestionRisk['mfa'].recommendation }}
            </ng-container>
          </nb-alert>
        </div>
      </div>

      <div class="col-md-6">
        <label class="label">7. Are your Git repositories protected with branch rules? *</label>
        <nb-radio-group [(ngModel)]="answers.gitProtection"
                        (ngModelChange)="onAnswerChange('gitProtection', $event)">
          <nb-radio value="yes">Yes - Branch protection enabled</nb-radio>
          <nb-radio value="no">No - Direct commits allowed</nb-radio>
        </nb-radio-group>
        <div class="risk-indicator" *ngIf="currentQuestionRisk['gitProtection']">
          <nb-alert [status]="currentQuestionRisk['gitProtection'].status">
            {{ currentQuestionRisk['gitProtection'].message }}
            <ng-container *ngIf="currentQuestionRisk['gitProtection'].consequence">
              <br><strong>Impact:</strong> {{ currentQuestionRisk['gitProtection'].consequence }}
            </ng-container>
            <ng-container *ngIf="currentQuestionRisk['gitProtection'].recommendation">
              <br><strong>Recommendation:</strong> {{ currentQuestionRisk['gitProtection'].recommendation }}
            </ng-container>
          </nb-alert>
        </div>
      </div>
    </div>

    <div class="row mt-3">
      <div class="col-md-6">
        <label class="label">8. Do you use secrets management tools? *</label>
        <nb-radio-group [(ngModel)]="answers.secretsManagement"
                        (ngModelChange)="onAnswerChange('secretsManagement', $event)">
          <nb-radio value="yes">Yes - Vault/AWS Secrets Manager/etc.</nb-radio>
          <nb-radio value="no">No - Hardcoded or basic storage</nb-radio>
        </nb-radio-group>
        <div class="risk-indicator" *ngIf="currentQuestionRisk['secretsManagement']">
          <nb-alert [status]="currentQuestionRisk['secretsManagement'].status">
            {{ currentQuestionRisk['secretsManagement'].message }}
            <ng-container *ngIf="currentQuestionRisk['secretsManagement'].consequence">
              <br><strong>Impact:</strong> {{ currentQuestionRisk['secretsManagement'].consequence }}
            </ng-container>
            <ng-container *ngIf="currentQuestionRisk['secretsManagement'].recommendation">
              <br><strong>Recommendation:</strong> {{ currentQuestionRisk['secretsManagement'].recommendation }}
            </ng-container>
          </nb-alert>
        </div>
      </div>

      <div class="col-md-6">
        <label class="label">9. What privileges are required to access critical features?</label>
        <nb-radio-group [(ngModel)]="answers.privilegesRequired"
                        (ngModelChange)="onAnswerChange('privilegesRequired', $event)">
          <nb-radio value="none">None - Anonymous access</nb-radio>
          <nb-radio value="low">Low - Basic user account</nb-radio>
          <nb-radio value="high">High - Admin/privileged account</nb-radio>
        </nb-radio-group>
        </div>
    </div>

    <div class="row mt-3">
      <div class="col-md-6">
        <label class="label">10. Does your system require user interaction for critical actions?</label>
        <nb-radio-group [(ngModel)]="answers.userInteraction"
                        (ngModelChange)="onAnswerChange('userInteraction', $event)">
          <nb-radio value="required">Yes - User interaction required</nb-radio>
          <nb-radio value="none">No - Automatic execution</nb-radio>
        </nb-radio-group>
        </div>

      <div class="col-md-6">
        <label class="label">11. Do you use exploit mitigation techniques?</label>
        <nb-radio-group [(ngModel)]="answers.exploitMitigation"
                        (ngModelChange)="onAnswerChange('exploitMitigation', $event)">
          <nb-radio value="yes">Yes - ASLR, DEP, CSP implemented</nb-radio>
          <nb-radio value="no">No - Basic security only</nb-radio>
        </nb-radio-group>
        <div class="risk-indicator" *ngIf="currentQuestionRisk['exploitMitigation']">
          <nb-alert [status]="currentQuestionRisk['exploitMitigation'].status">
            {{ currentQuestionRisk['exploitMitigation'].message }}
            <ng-container *ngIf="currentQuestionRisk['exploitMitigation'].recommendation">
              <br><strong>Recommendation:</strong> {{ currentQuestionRisk['exploitMitigation'].recommendation }}
            </ng-container>
          </nb-alert>
        </div>
      </div>
    </div>
  </nb-card-body>
</nb-card>

<nb-card class="mb-4">
  <nb-card-header>
    <h4>üí£ Impact Assessment </h4>
    <p class="text-muted">These questions assess the potential damage from successful attacks</p>
  </nb-card-header>
  <nb-card-body>
    <div class="row">
      <div class="col-md-4">
        <label class="label">12. Impact on Data Confidentiality if compromised?</label>
        <nb-radio-group [(ngModel)]="answers.confidentialityImpact"
                        (ngModelChange)="onAnswerChange('confidentialityImpact', $event)">
          <nb-radio value="none">None - Public data only</nb-radio>
          <nb-radio value="low">Low - Limited sensitive data</nb-radio>
          <nb-radio value="high">High - Critical confidential data</nb-radio>
        </nb-radio-group>
        </div>

      <div class="col-md-4">
        <label class="label">13. Impact on Data Integrity if compromised?</label>
        <nb-radio-group [(ngModel)]="answers.integrityImpact"
                        (ngModelChange)="onAnswerChange('integrityImpact', $event)">
          <nb-radio value="none">None - Read-only access</nb-radio>
          <nb-radio value="low">Low - Limited modification possible</nb-radio>
          <nb-radio value="high">High - Critical data can be altered</nb-radio>
        </nb-radio-group>
        </div>

      <div class="col-md-4">
        <label class="label">14. Impact on System Availability if compromised?</label>
        <nb-radio-group [(ngModel)]="answers.availabilityImpact"
                        (ngModelChange)="onAnswerChange('availabilityImpact', $event)">
          <nb-radio value="none">None - No service disruption</nb-radio>
          <nb-radio value="low">Low - Minor performance impact</nb-radio>
          <nb-radio value="high">High - Complete service outage</nb-radio>
        </nb-radio-group>
        </div>
    </div>

    <div class="row mt-3">
      <div class="col-md-6">
        <label class="label">15. What security measures have you implemented? *</label>
        <div class="security-measures">
          <nb-checkbox [(ngModel)]="answers.securityMeasures.accessControl"
                       (ngModelChange)="onSecurityMeasureChange('accessControl', $event); onAnswerChange('securityMeasures', answers.securityMeasures)">
            Access Control & Authentication
          </nb-checkbox>
          <nb-checkbox [(ngModel)]="answers.securityMeasures.encryption"
                       (ngModelChange)="onSecurityMeasureChange('encryption', $event); onAnswerChange('securityMeasures', answers.securityMeasures)">
            Data Encryption (at rest & in transit)
          </nb-checkbox>
          <nb-checkbox [(ngModel)]="answers.securityMeasures.audits"
                       (ngModelChange)="onSecurityMeasureChange('audits', $event); onAnswerChange('securityMeasures', answers.securityMeasures)">
            Regular Security Audits
          </nb-checkbox>
          <nb-checkbox [(ngModel)]="answers.securityMeasures.networkSecurity"
                       (ngModelChange)="onSecurityMeasureChange('networkSecurity', $event); onAnswerChange('securityMeasures', answers.securityMeasures)">
            Network Security (Firewall, IDS/IPS)
          </nb-checkbox>
          <nb-checkbox [(ngModel)]="answers.securityMeasures.incidentResponse"
                       (ngModelChange)="onSecurityMeasureChange('incidentResponse', $event); onAnswerChange('securityMeasures', answers.securityMeasures)">
            Incident Response Plan
          </nb-checkbox>
        </div>
        <div class="implemented-count mt-2">
          <nb-badge [status]="implementedSecurityMeasuresStatus" [text]="'Implemented: ' + implementedSecurityMeasuresCount + '/5'">
          </nb-badge>
        </div>
        <div class="risk-indicator" *ngIf="currentQuestionRisk['securityMeasures']">
          <nb-alert [status]="currentQuestionRisk['securityMeasures'].status">
            {{ currentQuestionRisk['securityMeasures'].message }}
          </nb-alert>
        </div>
      </div>

      <div class="col-md-6">
        <label class="label">16. Do you have security monitoring tools in place? *</label>
        <nb-radio-group [(ngModel)]="answers.monitoringTools"
                        (ngModelChange)="onAnswerChange('monitoringTools', $event)">
          <nb-radio value="yes">Yes - SIEM, logging, alerting</nb-radio>
          <nb-radio value="no">No - Limited or no monitoring</nb-radio>
        </nb-radio-group>
        <div class="risk-indicator" *ngIf="currentQuestionRisk['monitoringTools']">
          <nb-alert [status]="currentQuestionRisk['monitoringTools'].status">
            {{ currentQuestionRisk['monitoringTools'].message }}
            <ng-container *ngIf="currentQuestionRisk['monitoringTools'].consequence">
              <br><strong>Impact:</strong> {{ currentQuestionRisk['monitoringTools'].consequence }}
            </ng-container>
            <ng-container *ngIf="currentQuestionRisk['monitoringTools'].recommendation">
              <br><strong>Recommendation:</strong> {{ currentQuestionRisk['monitoringTools'].recommendation }}
            </ng-container>
          </nb-alert>
        </div>
      </div>
    </div>

    <div class="row mt-3">
      <div class="col-md-6">
        <label class="label">17. Do you have a contingency/disaster recovery plan? *</label>
        <nb-radio-group [(ngModel)]="answers.contingencyPlan"
                        (ngModelChange)="onAnswerChange('contingencyPlan', $event)">
          <nb-radio value="yes">Yes - Documented and tested</nb-radio>
          <nb-radio value="no">No - No formal plan</nb-radio>
        </nb-radio-group>
        <div class="risk-indicator" *ngIf="currentQuestionRisk['contingencyPlan']">
          <nb-alert [status]="currentQuestionRisk['contingencyPlan'].status">
            {{ currentQuestionRisk['contingencyPlan'].message }}
            <ng-container *ngIf="currentQuestionRisk['contingencyPlan'].consequence">
              <br><strong>Impact:</strong> {{ currentQuestionRisk['contingencyPlan'].consequence }}
            </ng-container>
            <ng-container *ngIf="currentQuestionRisk['contingencyPlan'].recommendation">
              <br><strong>Recommendation:</strong> {{ currentQuestionRisk['contingencyPlan'].recommendation }}
            </ng-container>
          </nb-alert>
        </div>
      </div>

      <div class="col-md-6">
        <label class="label">18. Do you use network segmentation?</label>
        <nb-radio-group [(ngModel)]="answers.networkSegmentation"
                        (ngModelChange)="onAnswerChange('networkSegmentation', $event)">
          <nb-radio value="yes">Yes - Networks are segmented</nb-radio>
          <nb-radio value="no">No - Flat network architecture</nb-radio>
        </nb-radio-group>
        </div>
    </div>
  </nb-card-body>
</nb-card>

<nb-card class="mb-4">
  <nb-card-header>
    <h4>üïí Temporal Assessment </h4>
    <p class="text-muted">These questions assess the current state of vulnerability exploitation and remediation</p>
  </nb-card-header>
  <nb-card-body>
    <div class="row">
      <div class="col-md-6">
        <label class="label">19. Do you use Static Application Security Testing (SAST)? *</label>
        <nb-radio-group [(ngModel)]="answers.staticAnalysis"
                        (ngModelChange)="onAnswerChange('staticAnalysis', $event)">
          <nb-radio value="yes">Yes - SonarQube, Checkmarx, etc.</nb-radio>
          <nb-radio value="no">No - No static analysis</nb-radio>
        </nb-radio-group>
        <div class="risk-indicator" *ngIf="currentQuestionRisk['staticAnalysis']">
          <nb-alert [status]="currentQuestionRisk['staticAnalysis'].status">
            {{ currentQuestionRisk['staticAnalysis'].message }}
            <ng-container *ngIf="currentQuestionRisk['staticAnalysis'].recommendation">
              <br><strong>Recommendation:</strong> {{ currentQuestionRisk['staticAnalysis'].recommendation }}
            </ng-container>
          </nb-alert>
        </div>
      </div>

      <div class="col-md-6">
        <label class="label">20. Do you use Dynamic Application Security Testing (DAST)? *</label>
        <nb-radio-group [(ngModel)]="answers.dynamicAnalysis"
                        (ngModelChange)="onAnswerChange('dynamicAnalysis', $event)">
          <nb-radio value="yes">Yes - OWASP ZAP, Burp Suite, etc.</nb-radio>
          <nb-radio value="no">No - No dynamic analysis</nb-radio>
        </nb-radio-group>
        <div class="risk-indicator" *ngIf="currentQuestionRisk['dynamicAnalysis']">
          <nb-alert [status]="currentQuestionRisk['dynamicAnalysis'].status">
            {{ currentQuestionRisk['dynamicAnalysis'].message }}
            <ng-container *ngIf="currentQuestionRisk['dynamicAnalysis'].recommendation">
              <br><strong>Recommendation:</strong> {{ currentQuestionRisk['dynamicAnalysis'].recommendation }}
            </ng-container>
          </nb-alert>
        </div>
      </div>
    </div>

    <div class="row mt-3">
      <div class="col-md-6">
        <label class="label">21. Do you use Software Composition Analysis (SCA) tools? *</label>
        <nb-radio-group [(ngModel)]="answers.scaTools"
                        (ngModelChange)="onAnswerChange('scaTools', $event)">
          <nb-radio value="yes">Yes - Snyk, OWASP Dependency-Check, etc.</nb-radio>
          <nb-radio value="no">No - No dependency scanning</nb-radio>
        </nb-radio-group>
        <div class="risk-indicator" *ngIf="currentQuestionRisk['scaTools']">
          <nb-alert [status]="currentQuestionRisk['scaTools'].status">
            {{ currentQuestionRisk['scaTools'].message }}
            <ng-container *ngIf="currentQuestionRisk['scaTools'].consequence">
              <br><strong>Impact:</strong> {{ currentQuestionRisk['scaTools'].consequence }}
            </ng-container>
            <ng-container *ngIf="currentQuestionRisk['scaTools'].recommendation">
              <br><strong>Recommendation:</strong> {{ currentQuestionRisk['scaTools'].recommendation }}
            </ng-container>
          </nb-alert>
        </div>
      </div>

      <div class="col-md-6">
        <label class="label">22. Do you regularly perform vulnerability scans? *</label>
        <nb-radio-group [(ngModel)]="answers.vulnerabilityScans"
                        (ngModelChange)="onAnswerChange('vulnerabilityScans', $event)">
          <nb-radio value="yes">Yes - Regular scanning schedule</nb-radio>
          <nb-radio value="no">No - Ad-hoc or never</nb-radio>
        </nb-radio-group>
        <div class="risk-indicator" *ngIf="currentQuestionRisk['vulnerabilityScans']">
          <nb-alert [status]="currentQuestionRisk['vulnerabilityScans'].status">
            {{ currentQuestionRisk['vulnerabilityScans'].message }}
          </nb-alert>
        </div>
      </div>
    </div>

    <div class="row mt-3">
      <div class="col-md-6">
        <label class="label">23. How often do you scan for vulnerabilities?</label>
        <nb-radio-group [(ngModel)]="answers.scanFrequency"
                        (ngModelChange)="onAnswerChange('scanFrequency', $event)">
          <nb-radio value="weekly">Weekly</nb-radio>
          <nb-radio value="monthly">Monthly</nb-radio>
          <nb-radio value="quarterly">Quarterly</nb-radio>
          <nb-radio value="never">Never/Ad-hoc</nb-radio>
        </nb-radio-group>
        </div>

      <div class="col-md-6">
        <label class="label">24. Have you identified any vulnerabilities? *</label>
        <nb-radio-group [(ngModel)]="answers.identifiedVulnerabilities"
                        (ngModelChange)="onAnswerChange('identifiedVulnerabilities', $event)">
          <nb-radio value="yes">Yes - Vulnerabilities found</nb-radio>
          <nb-radio value="no">No - Clean scan results</nb-radio>
        </nb-radio-group>
        </div>
    </div>

    <div class="row mt-3" *ngIf="answers.identifiedVulnerabilities === 'yes'">
      <div class="col-md-6">
        <label class="label">25. What is the highest severity level found?</label>
        <nb-radio-group [(ngModel)]="answers.vulnerabilitySeverity"
                        (ngModelChange)="onAnswerChange('vulnerabilitySeverity', $event)">
          <nb-radio value="critical">Critical</nb-radio>
          <nb-radio value="high">High</nb-radio>
          <nb-radio value="medium">Medium</nb-radio>
          <nb-radio value="low">Low</nb-radio>
        </nb-radio-group>
        </div>

      <div class="col-md-6">
        <label class="label">26. How quickly do you patch/remediate vulnerabilities?</label>
        <nb-radio-group [(ngModel)]="answers.patchingFrequency"
                        (ngModelChange)="onAnswerChange('patchingFrequency', $event)">
          <nb-radio value="immediate">Immediate (within 24h)</nb-radio>
          <nb-radio value="weekly">Weekly</nb-radio>
          <nb-radio value="monthly">Monthly</nb-radio>
          <nb-radio value="quarterly">Quarterly</nb-radio>
          <nb-radio value="never">Rarely/Never</nb-radio>
        </nb-radio-group>
        </div>
    </div>
  </nb-card-body>
</nb-card>

<nb-card class="mb-4">
  <nb-card-header>
    <h4>üåç Environmental Assessment </h4>
    <p class="text-muted">These questions assess the specific environment and context of your project</p>
  </nb-card-header>
  <nb-card-body>
    <div class="row">
      <div class="col-md-4">
        <label class="label">27. What is your project's criticality level?</label>
        <nb-radio-group [(ngModel)]="answers.projectCriticality"
                        (ngModelChange)="onAnswerChange('projectCriticality', $event)">
          <nb-radio value="low">Low - Internal tool</nb-radio>
          <nb-radio value="medium">Medium - Business application</nb-radio>
          <nb-radio value="high">High - Customer-facing</nb-radio>
          <nb-radio value="critical">Critical - Mission critical</nb-radio>
        </nb-radio-group>
        </div>

      <div class="col-md-4">
        <label class="label">28. What is your hosting environment?</label>
        <nb-radio-group [(ngModel)]="answers.hostingEnvironment"
                        (ngModelChange)="onAnswerChange('hostingEnvironment', $event)">
          <nb-radio value="cloud">Cloud (AWS, Azure, GCP)</nb-radio>
          <nb-radio value="on-premise">On-Premise</nb-radio>
          <nb-radio value="hybrid">Hybrid</nb-radio>
        </nb-radio-group>
        </div>

      <div class="col-md-4">
        <label class="label">29. What is your team's security experience level?</label>
        <nb-radio-group [(ngModel)]="answers.teamExperience"
                        (ngModelChange)="onAnswerChange('teamExperience', $event)">
          <nb-radio value="junior">Junior - Limited experience</nb-radio>
          <nb-radio value="intermediate">Intermediate - Some experience</nb-radio>
          <nb-radio value="senior">Senior - Experienced team</nb-radio>
          <nb-radio value="expert">Expert - Security specialists</nb-radio>
        </nb-radio-group>
        </div>
    </div>

    <div class="row mt-3">
      <div class="col-md-6">
        <label class="label">30. What compliance standards do you follow?</label>
        <textarea nbInput
                  fullWidth
                  placeholder="e.g., SOC 2, ISO 27001, PCI DSS, GDPR"
                  [(ngModel)]="answers.complianceStandards"
                  rows="2">
          </textarea>
        </div>

      <div class="col-md-6">
        <label class="label">31. What is your data classification?</label>
        <nb-radio-group [(ngModel)]="answers.dataClassification"
                        (ngModelChange)="onAnswerChange('dataClassification', $event)">
          <nb-radio value="public">Public</nb-radio>
          <nb-radio value="internal">Internal</nb-radio>
          <nb-radio value="confidential">Confidential</nb-radio>
          <nb-radio value="restricted">Restricted/Top Secret</nb-radio>
        </nb-radio-group>
        </div>
    </div>

    <div class="row mt-3">
      <div class="col-md-6">
        <label class="label">32. Do you provide regular security training? *</label>
        <nb-radio-group [(ngModel)]="answers.securityTraining"
                        (ngModelChange)="onAnswerChange('securityTraining', $event)">
          <nb-radio value="yes">Yes - Regular training program</nb-radio>
          <nb-radio value="no">No - Limited or no training</nb-radio>
        </nb-radio-group>
        </div>

      <div class="col-md-6" *ngIf="answers.securityTraining === 'yes'">
        <label class="label">33. How often is security training conducted?</label>
        <nb-radio-group [(ngModel)]="answers.trainingFrequency"
                        (ngModelChange)="onAnswerChange('trainingFrequency', $event)">
          <nb-radio value="monthly">Monthly</nb-radio>
          <nb-radio value="quarterly">Quarterly</nb-radio>
          <nb-radio value="annually">Annually</nb-radio>
          <nb-radio value="never">Never</nb-radio>
        </nb-radio-group>
        </div>
    </div>

    <div class="row mt-3">
      <div class="col-md-6">
        <label class="label">34. What access control model do you use?</label>
        <nb-radio-group [(ngModel)]="answers.accessControlModel"
                        (ngModelChange)="onAnswerChange('accessControlModel', $event)">
          <nb-radio value="none">None - Open access</nb-radio>
          <nb-radio value="basic">Basic - Username/Password</nb-radio>
          <nb-radio value="rbac">RBAC - Role-based access</nb-radio>
          <nb-radio value="abac">ABAC - Attribute-based access</nb-radio>
        </nb-radio-group>
        </div>
    </div>
  </nb-card-body>
</nb-card>


 <!-- Repository Analysis Results -->
  <nb-card *ngIf="repositoryAnalysis" class="mb-4">
    <nb-card-header>
      <h4>üîç Automated Repository Analysis</h4>
    </nb-card-header>
    <nb-card-body>
      <div *ngIf="automatedScanInProgress" class="text-center">
        <nb-spinner size="large"></nb-spinner>
        <p class="mt-2">Running automated security analysis...</p>
      </div>
      
      <div *ngIf="!automatedScanInProgress && repositoryAnalysis">
        <div class="row">
          <div class="col-md-3">
            <nb-alert status="info">
              <strong>Repository:</strong> {{ repositoryAnalysis.type | titlecase }}
            </nb-alert>
          </div>
          <div class="col-md-9">
            <p><strong>URL:</strong> {{ repositoryAnalysis.url }}</p>
            <p *ngIf="repositoryAnalysis.gitlabProjectUrl">
              <strong>Analysis Repository:</strong> 
              <a [href]="repositoryAnalysis.gitlabProjectUrl" target="_blank">{{ repositoryAnalysis.gitlabProjectUrl }}</a>
            </p>
            <p *ngIf="repositoryAnalysis.pipelineUrl">
              <strong>Pipeline:</strong> 
              <a [href]="repositoryAnalysis.pipelineUrl" target="_blank">View Pipeline Results</a>
            </p>
          </div>
        </div>

        <div class="row mt-3" *ngIf="repositoryAnalysis.findings">
          <div class="col-md-3">
            <nb-card status="warning" size="small">
              <nb-card-body class="text-center">
                <h5>üîê Secrets Found</h5>
                <h3>{{ repositoryAnalysis.findings.secrets || 0 }}</h3>
              </nb-card-body>
            </nb-card>
          </div>
          <div class="col-md-3">
            <nb-card status="danger" size="small">
              <nb-card-body class="text-center">
                <h5>üö® Vulnerabilities</h5>
                <h3>{{ repositoryAnalysis.findings.vulnerabilities || 0 }}</h3>
              </nb-card-body>
            </nb-card>
          </div>
          <div class="col-md-3">
            <nb-card status="info" size="small">
              <nb-card-body class="text-center">
                <h5>üì¶ Dependencies</h5>
                <h3>{{ repositoryAnalysis.findings.dependencies || 0 }}</h3>
              </nb-card-body>
            </nb-card>
          </div>
          <div class="col-md-3">
            <nb-card status="success" size="small">
              <nb-card-body class="text-center">
                <h5>üåø Branches</h5>
                <h3>{{ repositoryAnalysis.findings.branches || 'N/A' }}</h3>
              </nb-card-body>
            </nb-card>
          </div>
        </div>

        <div class="mt-3" *ngIf="repositoryAnalysis.automatedScanTriggered">
          <nb-alert status="success">
            <strong>‚úÖ Automated Analysis Complete!</strong>
            The repository has been successfully analyzed. Results are being processed and will be included in your final report.
          </nb-alert>
        </div>
      </div>
    </nb-card-body>
  </nb-card>

  <!-- CVSS Scores Dashboard -->
  <nb-card class="mb-4">
    <nb-card-header>
      <h4>üìä CVSS Security Assessment Dashboard</h4>
    </nb-card-header>
    <nb-card-body>
      <!-- Overall Risk Score -->
      <div class="row mb-4">
        <div class="col-12 text-center">
          <div class="risk-score-container" [style.background-color]="getRiskColor()">
            <h2 class="text-white mb-0">{{ cvssScores.overallRiskScore.toFixed(1) }}/10</h2>
            <p class="text-white mb-0">{{ getCVSSSeverityRating() }} Risk</p>
          </div>
        </div>
      </div>

      <!-- CVSS Score Breakdown -->
      <div class="row">
        <div class="col-md-3">
          <nb-card status="primary" size="small">
            <nb-card-body class="text-center">
              <h6>Base Score</h6>
              <h4>{{ cvssScores.baseScore.toFixed(1) }}</h4>
              <small>Core vulnerability metrics</small>
            </nb-card-body>
          </nb-card>
        </div>
        <div class="col-md-3">
          <nb-card status="info" size="small">
            <nb-card-body class="text-center">
              <h6>Temporal Score</h6>
              <h4>{{ cvssScores.temporalScore.toFixed(1) }}</h4>
              <small>Time-sensitive factors</small>
            </nb-card-body>
          </nb-card>
        </div>
        <div class="col-md-3">
          <nb-card status="warning" size="small">
            <nb-card-body class="text-center">
              <h6>Environmental Score</h6>
              <h4>{{ cvssScores.environmentalScore.toFixed(1) }}</h4>
              <small>Environmental context</small>
            </nb-card-body>
          </nb-card>
        </div>
        <div class="col-md-3">
          <nb-card status="success" size="small">
            <nb-card-body class="text-center">
              <h6>Exploitability</h6>
              <h4>{{ cvssScores.exploitabilityScore.toFixed(1) }}</h4>
              <small>Exploit difficulty</small>
            </nb-card-body>
          </nb-card>
        </div>
      </div>
      
    <!-- Impact Score Card -->
    <div class="row mt-3">
      <div class="col-md-3">
        <nb-card status="danger" size="small">
          <nb-card-body class="text-center">
            <h6>Impact Score</h6>
            <h4>{{ cvssScores.impactScore.toFixed(1) }}</h4>
            <small>Potential damage</small>
          </nb-card-body>
        </nb-card>
      </div>
    </div>

      <!-- Risk Categories -->
      <div class="row mt-4">
        <div class="col-12">
          <h5>Risk Category Breakdown</h5>
          <div class="risk-categories">
            <div *ngFor="let category of riskCategories" class="mb-3">
              <div class="d-flex justify-content-between align-items-center mb-1">
                <span><strong>{{ category.name }}</strong></span>
                <span>{{ category.score.toFixed(1) }}/{{ category.maxScore }}</span>
              </div>
              <nb-progress-bar 
                [value]="(category.score / category.maxScore) * 100" 
                [status]="category.status"
                size="medium">
              </nb-progress-bar>
              <small class="text-muted">{{ category.metrics.join(', ') }}</small>
            </div>
          </div>
        </div>
      </div>
    </nb-card-body>
  </nb-card>

  <!-- Security Recommendations -->
  <nb-card *ngIf="recommendations.length > 0" class="mb-4">
    <nb-card-header>
      <h4>üéØ Priority Security Recommendations</h4>
    </nb-card-header>
    <nb-card-body>
      <div class="recommendations-list">
        <div *ngFor="let rec of recommendations; let i = index" class="recommendation-item mb-3">
          <nb-card [status]="rec.priority === 'critical' ? 'danger' : rec.priority === 'high' ? 'warning' : rec.priority === 'medium' ? 'info' : 'basic'" size="small">
            <nb-card-body>
              <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                  <h6 class="mb-1">
                    <nb-badge [status]="rec.priority === 'critical' ? 'danger' : rec.priority === 'high' ? 'warning' : rec.priority === 'medium' ? 'info' : 'basic'" 
                              class="me-2">{{ rec.priority | titlecase }}</nb-badge>
                    {{ rec.title }}
                  </h6>
                  <p class="mb-2">{{ rec.description }}</p>
                  <div class="row">
                    <div class="col-md-4">
                      <small><strong>Category:</strong> {{ rec.category }}</small>
                    </div>
                    <div class="col-md-4">
                      <small><strong>Timeline:</strong> {{ rec.timeline }}</small>
                    </div>
                    <div class="col-md-4">
                      <small><strong>Effort:</strong> {{ rec.effort | titlecase }}</small>
                    </div>
                  </div>
                  <div class="mt-2">
                    <small><strong>Affected CVSS Metrics:</strong> {{ rec.affectedMetrics.join(', ') }}</small>
                  </div>
                </div>
                <div class="text-end">
                  <div class="cvss-impact">
                    <small>CVSS Impact</small>
                    <div [class]="rec.cvssImpact < 0 ? 'text-success' : 'text-warning'">
                      <strong>{{ rec.cvssImpact > 0 ? '+' : '' }}{{ rec.cvssImpact.toFixed(1) }}</strong>
                    </div>
                  </div>
                </div>
              </div>
            </nb-card-body>
          </nb-card>
        </div>
      </div>
    </nb-card-body>
  </nb-card>

  <!-- Action Plan -->
  <nb-card *ngIf="actionPlan.length > 0" class="mb-4">
    <nb-card-header>
      <h4>üìã Security Action Plan</h4>
    </nb-card-header>
    <nb-card-body>
      <div class="action-plan-list">
        <div *ngFor="let action of actionPlan; let i = index" class="action-item mb-3">
          <nb-card size="small">
            <nb-card-body>
              <div class="d-flex justify-content-between align-items-center">
                <div class="flex-grow-1">
                  <h6 class="mb-1">
                    <nb-badge [status]="action.priority === 'high' ? 'danger' : action.priority === 'medium' ? 'warning' : 'info'" 
                              class="me-2">{{ action.priority | titlecase }}</nb-badge>
                    {{ action.title }}
                  </h6>
                  <p class="mb-2">{{ action.description }}</p>
                  <div class="row">
                    <div class="col-md-4" *ngIf="action.assignee">
                      <small><strong>Assignee:</strong> {{ action.assignee }}</small>
                    </div>
                    <div class="col-md-4" *ngIf="action.dueDate">
                      <small><strong>Due Date:</strong> {{ action.dueDate | date:'short' }}</small>
                    </div>
                    <div class="col-md-4">
                      <nb-badge [status]="action.status === 'completed' ? 'success' : action.status === 'in-progress' ? 'warning' : 'basic'">
                        {{ action.status | titlecase }}
                      </nb-badge>
                    </div>
                  </div>
                </div>
              </div>
            </nb-card-body>
          </nb-card>
        </div>
      </div>
    </nb-card-body>
  </nb-card>

  <!-- Final Report Generation -->
  <nb-card class="mb-4">
    <nb-card-header>
      <h4>üìÑ Generate Final Report</h4>
    </nb-card-header>
    <nb-card-body>
      <div class="report-generation">
        <div class="row">
          <div class="col-md-6">
            <button nbButton status="primary" (click)="generateFinalReport()" class="mb-3 w-100">
              <nb-icon icon="file-text-outline"></nb-icon>
              Generate Report
            </button>
          </div>
          <div class="col-md-6">
            <button nbButton status="success" (click)="exportToPDF()" [disabled]="!finalReport" class="mb-3 w-100">
              <nb-icon icon="download-outline"></nb-icon>
              Export to PDF
            </button>
          </div>
        </div>
        
        <div *ngIf="finalReport" class="mt-3">
          <nb-alert status="success">
            <strong>‚úÖ Report Generated Successfully!</strong>
            Your comprehensive security assessment report is ready. You can now export it to PDF or send it via email.
          </nb-alert>
          
          <div class="report-summary">
            <h6>Report Summary:</h6>
            <ul>
              <li><strong>Project:</strong> {{ finalReport.projectName }}</li>
              <li><strong>Assessment Date:</strong> {{ finalReport.assessmentDate | date:'full' }}</li>
              <li><strong>CVSS Score:</strong> {{ finalReport.cvssScores.baseScore.toFixed(1) }} ({{ finalReport.severityRating }})</li>
              <li><strong>Recommendations:</strong> {{ finalReport.recommendations.length }} items</li>
              <li><strong>Risk Categories:</strong> {{ finalReport.riskCategories.length }} assessed</li>
            </ul>
          </div>

          <div class="mt-3" *ngIf="answers.email">
            <button nbButton status="info" (click)="sendEmailReport()" class="w-100">
              <nb-icon icon="email-outline"></nb-icon>
              Send Report to {{ answers.email }}
            </button>
          </div>
        </div>
      </div>
    </nb-card-body>
  </nb-card>
<!-- CVSS Metrics Summary -->
<nb-card class="mb-4">
  <nb-card-header>
    <h4>üîç CVSS Metrics Summary</h4>
  </nb-card-header>
  <nb-card-body>
    <div class="cvss-metrics-summary">
      <div class="row">
        <div class="col-md-6">
          <h6>Base Metrics</h6>
          <table class="table table-sm">
            <tbody>
              <tr>
                <td><strong>Attack Vector:</strong></td>
                <td>{{ answers.attackVector ? (answers.attackVector | titlecase) : 'Not Defined' }}</td>
              </tr>
              <tr>
                <td><strong>Attack Complexity:</strong></td>
                <td>{{ answers.attackComplexity ? (answers.attackComplexity | titlecase) : 'Not Defined' }}</td>
              </tr>
              <tr>
                <td><strong>Privileges Required:</strong></td>
                <td>{{ answers.privilegesRequired ? (answers.privilegesRequired | titlecase) : 'Not Defined' }}</td>
              </tr>
              <tr>
                <td><strong>User Interaction:</strong></td>
                <td>{{ answers.userInteraction? (answers.userInteraction| titlecase) : 'Not Defined' }}</td>
              </tr>
              <tr>
                <td><strong>Scope:</strong></td>
                <td>{{ answers.scope? (answers.scope | titlecase) : 'Not Defined' }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col-md-6">
          <h6>Impact Metrics</h6>
          <table class="table table-sm">
            <tbody>
              <tr>
                <td><strong>Confidentiality:</strong></td>
                <td>{{ answers.confidentialityImpact ? (answers.confidentialityImpact | titlecase) : 'Not Defined'}}</td>
              </tr>
              <tr>
                <td><strong>Integrity:</strong></td>
                <td>{{ answers.integrityImpact? (answers.integrityImpact | titlecase) : 'Not Defined'}}</td>
              </tr>
              <tr>
                <td><strong>Availability:</strong></td>
                <td>{{ answers.availabilityImpact ? (answers.availabilityImpact | titlecase) : 'Not Defined' }}</td>
              </tr>
            </tbody>
          </table>
          
          <h6 class="mt-3">Temporal Metrics</h6>
          <table class="table table-sm">
            <tbody>
              <tr>
                <td><strong>Exploit Code Maturity:</strong></td>
                <td>{{ answers.exploitCodeMaturity ? (answers.exploitCodeMaturity | titlecase) : 'Not Defined' }}</td>
              </tr>
              <tr>
                <td><strong>Remediation Level:</strong></td>
                <td>{{ answers.remediationLevel ? (answers.remediationLevel| titlecase) : 'Not Defined' }}</td>
              </tr>
              <tr>
                <td><strong>Report Confidence:</strong></td>
                <td>{{ answers.reportConfidence ? (answers.reportConfidence | titlecase) : 'Not Defined'}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </nb-card-body>
</nb-card>

  <style>
    .risk-score-container {
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .risk-categories {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
    }

    .recommendation-item {
      border-left: 4px solid;
    }

    .recommendation-item[data-priority="critical"] {
      border-left-color: #dc3545;
    }

    .recommendation-item[data-priority="high"] {
      border-left-color: #fd7e14;
    }

    .recommendation-item[data-priority="medium"] {
      border-left-color: #0dcaf0;
    }

    .recommendation-item[data-priority="low"] {
      border-left-color: #6c757d;
    }

    .cvss-impact {
      text-align: center;
      padding: 8px;
      border-radius: 4px;
      background: #f8f9fa;
    }

    .action-item nb-card {
      transition: all 0.3s ease;
    }

    .action-item:hover nb-card {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .report-summary {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .report-summary ul {
      margin-bottom: 0;
    }

    .cvss-metrics-summary .table td {
      border: none;
      padding: 0.25rem 0.5rem;
    }

    .cvss-metrics-summary .table td:first-child {
      width: 60%;
    }

    nb-progress-bar {
      margin-bottom: 5px;
    }

    .recommendations-list .recommendation-item:last-child {
      margin-bottom: 0;
    }

    .action-plan-list .action-item:last-child {
      margin-bottom: 0;
    }
 
.evaluation-container {
  max-width: 1000px;
  margin: 0 auto;
  padding: 20px;
}

.risk-dashboard {
  position: sticky;
  top: 20px;
  z-index: 100;
  margin-bottom: 20px;
}

.risk-overview {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.risk-meter {
  flex: 1;
  margin-right: 20px;
}

.risk-categories {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
}

.risk-category {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: #f8f9fa;
  border-radius: 4px;
}

.risk-indicator {
  margin-top: 10px;
  padding: 10px;
  border-radius: 4px;
}

.matrix-container {
  overflow-x: auto;
}

.matrix-grid {
  display: grid;
  grid-template-columns: 120px repeat(4, 1fr);
  gap: 2px;
  min-width: 600px;
}

.matrix-header {
  display: contents;
  font-weight: bold;
}

.matrix-row {
  display: contents;
}

.probability-label {
  display: flex;
  align-items: center;
  justify-content: center;
  background: #e9ecef;
  padding: 15px;
  font-weight: bold;
}

.matrix-cell {
  height: 80px;
  border: 1px solid #dee2e6;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
}

.matrix-cell:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.matrix-cell.low { background-color: #d4edda; }
.matrix-cell.medium { background-color: #fff3cd; }
.matrix-cell.high { background-color: #f8d7da; }
.matrix-cell.critical { background-color: #d1ecf1; }

.risk-count {
  font-size: 24px;
  font-weight: bold;
}

.action-item {
  padding: 15px;
  border: 1px solid #e9ecef;
  border-radius: 8px;
  margin-bottom: 15px;
}

.action-item h5 {
  margin-bottom: 10px;
  color: #495057;
}

.export-options {
  text-align: center;
  margin-top: 30px;
}

.export-options button {
  margin: 0 10px;
}

nb-list-item {
  padding: 15px 0;
  border-bottom: 1px solid #e9ecef;
}

nb-list-item:last-child {
  border-bottom: none;
}

nb-radio-group {
  display: flex;
  gap: 20px;
  margin: 10px 0;
}

nb-checkbox {
  display: block;
  margin: 8px 0;
}

.mt-1 { margin-top: 5px; }
.mt-2 { margin-top: 10px; }
</style>